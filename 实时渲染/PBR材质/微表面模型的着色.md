# 微表面模型的着色

## Linearly Transformed Cosines
LTC方法是在光源位置确定的时候，对于一个微表面模型快速计算出其着色结果的方法

为了对微表面模型进行着色，在固定一个出射方向的时候，BRDF是一个二维函数，需要在这个二位函数的波瓣当中对其中的光源进行采样。而LTC可以避免这种采样

### 核心想法
通过线性变换将固定输入方向得到的波瓣（球面上的一个区域）变换成一个朝上的余弦函数的分布，同时将面光源变换到朝上的方向
从而将问题转换为cos函数在变换后的多边形光源区域内的积分，而这个积分有解析解

### 数学推导
假设一个线性变换$M$能够做到上述功能
将渲染方程简写为：
$$
L(\omega_o)=\int_PL_iF(\omega_i)d\omega_i
$$
$P$表示面光源，假设面光源中$L_i$恒定
得到：
$$
L(\omega_o)=L_i\int_PF(\omega_i)d\omega_i
$$
对于任意方向$\omega_i$，为了保证方向向量的标准化，变换后的方向$\omega^{'}$为：
$$
w_i=\frac{M\omega_i^{'}}{||M\omega_i^{'}||}
$$
由于假设了变换可将原函数变为余弦函数，将上述结果代入表达式：
$$
L(\omega_0)=L_i\int_{P'}cos(\omega_i^{'})d\frac{M\omega_i^{'}}{||M\omega_i^{'}||}
$$
引入一个Jaccobian项$J$，将积分写为：
$$
L(\omega_0)=L_i\int_{P'}cos(\omega_i^{'})Jd\omega_i^{'}
$$
将积分写为这一形式之后，就可以解析的算出着色结果
而尚未解决的问题是此变换本身$M$没有解出，这一部分交给预计算完成

