# 摘要
在物体上的某些顶点放置探针，针对这些探针烘焙SH系数。渲染时通过插值计算得到GI结果。可以在顶点阶段完成GI计算，适合手机上的TBR。

# 方法
## 光照计算
在模型的每个顶点处计算一个球谐系数用于拟合全局光，每个顶点的球谐系数计算由多个保存在模型上的球谐系数和一个混合权重获得，这个混合权重是一个描述探针分布的量$\mathcal{A}$决定的，即：
$$
SH_{v_i}=W_jSH_j+...+W_nSH_n
$$
得到顶点球谐系数之后，根据则三角形内每个点都可以由其三个顶点的球谐光照结果插值得到，即：
$$
\hat{f}(\mathcal{A};p)=\frac{1}{\pi}\sum_{l=0}^\infty\sum_{m=-l}^l(b_aSH_{v_a}+b_bSH_{v_b}+b_cSH_{v_c})^m_lT(Y^m_l(\mathcal{d}))
$$
其中$b$为重心插值权重
## 烘焙
本文不采用直接求光照+投影的方式得到球谐系数，而是通过优化的方式去得到。具体来说，定义了一个光照损失函数：
$$
E_{light}=\int_S(\int_\Omega w(d)(\hat{f}(\mathcal{A};p,d)-f(p,d))dd)dp
$$
其中是一个描述探针分布的量，每一个物体对应一个$\mathcal{A}$，$f$为场景真实光照
除了考虑光照外，还考虑一个保证光照结果光滑的损失，即：
$$
E_{reg}=\sum_{v\in S}||\nabla\hat f(\mathcal{A};v,n)||^2
$$
## 探针放置
本文的探针是防止在物体的一些顶点之上，其他的顶点的球谐系数值由作为探针的顶点插值而来。探针顶点的选取使用K-Medoids方法，即随机选择K个质心，计算其他点到质心的距离，再选择其他一个点作为质心，不断优化得到最终的聚类结果。
定义两个顶点之间的距离为：在几何体中做最短路得到的距离。这种最短路依照规则：若两个点可见，则使用欧几里得距离，否则做Djistra算法得到两点距离。
在进行SH系数计算时，取每个采样点周围n个探针，将其距离的倒数归一化之后作为权重，插值得到SH系数。
